## Happy

Points: 242

Solves: 36

## Problem Description

No, we'Re not SAd. We are Happy!


## Problem Gist
Use an extra parameter in an RSA public key and Coppersmith's LLL-based small roots to factor modulus and obtain original message

## Solution

The problem description makes it pretty clear that this challenge is RSA.  Indeed, we are given 3 files of importance: happy (.rb), pub.key, and flag.enc.  We open happy.rb and find the definition of a custom defined Key class, of which the following lines are important:

```
def self.import(str)
    Key.new(Marshal.load(str))
```

So we can safely deduce here that the pub.key file is a serialized public key that is deserialized and parsed by the key class.  Deserializing the pub.key file yields the following parameters:

```
irb(main):001:0> Marshal.load(File.binread("pub.key"))                                                  
=> {:n=>5452318773620154613572502669913080727339917760196646730652258556145398937256752632887555812737783373177353194432136071770417979324393263857781686277601413222025718171529583036919918011865659343346014570936822522629937049429335236497295742667600448744568785484756006127827416640477334307947919462834229613581880109765730148235236895292544500644206990455843770003104212381715712438639535055758354549980537386992998458659247267900481624843632733660905364361623292713318244751154245275273626636275353542053068704371642619745495065026372136566314951936609049754720223393857083115230045986813313700617859091898623345607326632849260775745046701800076472162843326078037832455202509171395600120638911, :e=>65537, :cf=>25895436290109491245101531425889639027975222438101136560069483392652360882638128551753089068088836092997653443539010850513513345731351755050869585867372758989503310550889044437562615852831901962404615732967948739458458871809980240507942550191679140865230350818204637158480970417486015745968144497190368319745738055768539323638032585508830680271618024843807412695197298088154193030964621282487334463994562290990124211491040392961841681386221639304429670174693151}
```

Interesting--normally, an RSA public key would contain only (N, e).  The `cf` parameter seems like it shouldn't be there.

Going back to the code, we find that `cf = p.pow(q ** (k - 1) * (q - 1) - 1, q ** k)`, in other words: cf = p^(q^(k - 1) * (q - 1) - 1) mod q^k.  

This certainly doesn't match any known definition of RSA, so we infer that it's an extra parameter. Additionally, we note that the Key class is an implementation of multi-prime RSA in the form N = pq^2.  Given this, we decide to 